from .models import APIkey
from nltk.sentiment.vader import SentimentIntensityAnalyzer
from nltk.sentiment.util import *
import pandas as pd
import nltk
import numpy as np
from nltk.stem import PorterStemmer
import pickle
import random
import string

#Stopwords
stopwords = {"aren't", 's', "didn't", 'how', 'by', 'ma', 'myself', "it's", 'isn', 'further', 't', 'yours', 'we', 'and', 'shan', 'me', 'having', 'each', 're', 'other', 'with', 'haven', 'to', 'into', 'the', 'being', 'at', 'for', 'too', 'hadn', 'again', "hadn't", 'aren', 'they', 'both', 'wouldn', 'than', 'couldn', 'but', 'can', 'before', 'after', "you'll", 'should', 'y', "shan't", 'because', 'same', 'doesn', "needn't", 'if', 'these', 'your', 'down', 'ain', 'no', 'now', 'only', 'hasn', 'there', 'him', "that'll", 'as', 'while', 'more', 'very', 'been', 'were', 'you', 'doing', 'which', 'am', 'has', 'my', 'in', 'hers', "shouldn't", "you're", 'few', 'be', 'what', 'any', 'didn', 'nor', 'once', 'mightn', 'when', 'a', 'so', 'off', 'own', 'this', 'o', 'shouldn', 'mustn', 'himself', 'ourselves', 'yourselves', 'will', 'needn', 'until', 'does', "should've", 'had', 'from', 'her', 'its', 'an', 'out', 'our', 'here', 'up', 'not', 'theirs', 'then', 'all', 'those', 'through', 'i', "isn't", "weren't", 'such', "couldn't", 'between', 'over', 'them', "hasn't", 'don', "haven't", 'wasn', "wasn't", 'just', "you'd", 'above', 'do', 'was', 'it', 'under', 'why', 'about', 'he', 'during', "don't", 'on', 've', "wouldn't", 'below', 'm', 'weren', "mightn't", "mustn't", 'themselves', 'she', 'yourself', "she's", 'have', 'against', 'most', "won't", 'ours', 'are', 'who', 'or', 'did', 'won', 'is', 'll', 'his', "doesn't", 'their', 'of', 'that', 'd', 'where', 'herself', 'some', "you've", 'whom', 'itself'}

#Top 1500 words
word_features = ['one', 'would', 'said', 'time', 'new', 'year', 'could', 'like', 'state', 'use', 'may', 'two', 'first', 'even', 'make', 'man', 'work', 'made', 'day', 'also', 'way', 'mani', 'go', 'look', 'must', 'back', 'af', 'get', 'come', 'much', 'well', 'see', 'peopl', 'good', 'take', 'seem', 'know', 'gener', 'littl', 'place', 'say', 'world', 'still', 'hand', 'long', 'men', 'nation', 'hous', 'life', 'develop', 'need', 'call', 'last', 'thing', 'right', 'never', 'school', 'unit', 'anoth', 'great', 'us', 'might', 'turn', 'mean', 'old', 'american', 'want', 'point', 'sinc', 'part', 'came', 'home', 'three', 'number', 'ask', 'think', 'interest', 'give', 'thought', 'person', 'differ', 'form', 'live', 'follow', 'show', 'without', 'present', 'found', 'end', 'provid', 'possibl', 'around', 'open', 'problem', 'area', 'head', 'word', 'program', 'public', 'howev', 'system', 'find', 'set', 'small', 'eye', 'effect', 'fact', 'group', 'face', 'cours', 'govern', 'plan', 'becom', 'import', 'order', 'line', 'put', 'case', 'chang', 'forc', 'went', 'name', 'move', 'high', 'citi', 'water', 'upon', 'feel', 'war', 'everi', 'result', 'continu', 'tri', 'side', 'increas', 'help', 'commun', 'power', 'offic', 'got', 'left', 'play', 'countri', 'oper', 'experi', 'busi', 'studi', 'servic', 'reason', 'member', 'question', 'alway', 'away', 'toward', 'requir', 'someth', 'sever', 'report', 'start', 'complet', 'night', 'church', 'room', 'close', 'though', 'less', 'light', 'almost', 'enough', 'larg', 'took', 'social', 'natur', 'includ', 'far', 'appear', 'presid', 'let', 'yet', 'better', 'week', 'told', 'noth', 'cost', 'famili', 'act', 'valu', 'second', 'later', 'knew', 'next', 'direct', 'product', 'run', 'mind', 'law', 'white', 'car', 'young', 'boy', 'posit', 'given', 'matter', 'expect', 'compani', 'inform', 'univers', 'rather', 'per', 'meet', 'often', 'among', 'john', 'industri', 'final', 'love', 'earli', 'return', 'polit', 'girl', 'four', 'big', 'within', 'action', 'felt', 'saw', 'activ', 'kind', 'children', 'along', 'tell', 'individu', 'figur', 'best', 'human', 'sens', 'organ', 'field', 'read', 'door', 'care', 'keep', 'exampl', 'believ', 'student', 'ever', 'leav', 'least', 'reach', 'probabl', 'bodi', 'consid', 'rate', 'pass', 'idea', 'concern', 'period', 'talk', 'educ', 'miss', 'measur', 'god', 'respons', 'build', 'control', 'walk', 'type', 'hope', 'remain', 'other', 'determin', 'design', 'although', 'record', 'local', 'month', 'hour', 'done', 'stand', 'whole', 'level', 'exist', 'certain', 'thu', 'begin', 'began', 'receiv', 'object', 'major', 'sure', 'indic', 'train', 'process', 'music', 'condit', 'perhap', 'carri', 'book', 'colleg', 'street', 'moment', 'relat', 'job', 'york', 'usual', 'serv', 'recent', 'quit', 'age', 'practic', 'past', 'step', 'sound', 'econom', 'histori', 'caus', 'method', 'board', 'special', 'friend', 'center', 'support', 'class', 'subject', 'note', 'polici', 'evid', 'cut', 'five', 'materi', 'land', 'whether', 'happen', 'gave', 'death', 'today', 'either', 'court', 'art', 'feet', 'addit', 'understand', 'across', 'taken', 'success', 'hold', 'anyth', 'write', 'seen', 'societi', 'depart', 'answer', 'wait', 'parti', 'arm', 'realli', 'half', 'except', 'avail', 'actual', 'manag', 'alreadi', 'view', 'issu', 'fire', 'effort', 'town', 'stop', 'learn', 'suggest', 'voic', 'togeth', 'tax', 'shall', 'money', 'accept', 'situat', 'involv', 'letter', 'feder', 'held', 'free', 'associ', 'air', 'clear', 'section', 'perform', 'real', 'term', 'cover', 'cannot', 'behind', 'author', 'total', 'produc', 'establish', 'road', 'color', 'allow', 'purpos', 'million', 'express', 'centuri', 'brought', 'minut', 'ground', 'whose', 'repres', 'rememb', 'test', 'heard', 'hear', 'becam', 'ago', 'watch', 'stage', 'respect', 'known', 'limit', 'tabl', 'short', 'mother', 'south', 'observ', 'market', 'entir', 'discuss', 'offer', 'pictur', 'base', 'rang', 'bring', 'west', 'prepar', 'intern', 'administr', 'spirit', 'full', 'wall', 'sometim', 'lead', 'front', 'charg', 'true', 'surfac', 'modern', 'common', 'wife', 'peac', 'dark', 'futur', 'consider', 'woman', 'top', 'pressur', 'necessari', 'claim', 'properti', 'amount', 'piec', 'outsid', 'morn', 'mile', 'approach', 'six', 'rest', 'list', 'wonder', 'demand', 'beauti', 'achiev', 'near', 'ad', 'abl', 'rule', 'pay', 'hundr', 'black', 'child', 'stori', 'origin', 'institut', 'enter', 'stood', 'militari', 'fall', 'union', 'fear', 'stay', 'space', 'appli', 'statement', 'mark', 'paper', 'deal', 'therefor', 'share', 'north', 'hard', 'collect', 'washington', 'visit', 'sign', 'privat', 'function', 'secretari', 'equip', 'die', 'decid', 'immedi', 'father', 'contain', 'wish', 'tradit', 'rais', 'moral', 'island', 'strong', 'red', 'project', 'variou', 'plant', 'fill', 'defens', 'describ', 'depend', 'soon', 'decis', 'suppli', 'food', 'bill', 'desir', 'alon', 'heart', 'women', 'station', 'gone', 'english', 'drop', 'america', 'third', 'son', 'longer', 'grow', 'christian', 'select', 'regard', 'refer', 'basic', 'aid', 'late', 'central', 'speak', 'press', 'critic', 'counti', 'troubl', 'standard', 'attempt', 'remov', 'greater', 'engin', 'hors', 'compar', 'kept', 'committe', 'attent', 'trade', 'singl', 'particular', 'everyth', 'brown', 'basi', 'rise', 'remark', 'event', 'east', 'appar', 'sourc', 'river', 'paint', 'mere', 'wrote', 'sort', 'research', 'physic', 'leader', 'improv', 'detail', 'cent', 'william', 'reduc', 'propos', 'principl', 'price', 'insid', 'cold', 'account', 'volum', 'game', 'park', 'obtain', 'employ', 'wide', 'sale', 'realiz', 'floor', 'factor', 'explain', 'equal', 'creat', 'consist', 'specif', 'smile', 'fight', 'els', 'normal', 'movement', 'low', 'foreign', 'dead', 'beyond', 'assist', 'opportun', 'contribut', 'accord', 'trial', 'lost', 'instead', 'imagin', 'district', 'data', 'construct', 'window', 'squar', 'southern', 'prevent', 'locat', 'fine', 'stock', 'sit', 'simpli', 'elect', 'club', 'religi', 'permit', 'element', 'attack', 'similar', 'progress', 'lot', 'kill', 'separ', 'labor', 'firm', 'medic', 'lack', 'doubt', 'democrat', 'shown', 'scienc', 'reaction', 'pattern', 'negro', 'danc', 'ten', 'suppos', 'blue', 'symbol', 'structur', 'influenc', 'drive', 'assign', 'recogn', 'popul', 'inde', 'especi', 'england', 'averag', 'temperatur', 'simpl', 'offici', 'gun', 'feed', 'difficult', 'tree', 'region', 'pull', 'higher', 'hair', 'assum', 'techniqu', 'readi', 'qualiti', 'polic', 'favor', 'touch', 'race', 'occur', 'imag', 'fund', 'emot', 'coupl', 'cloth', 'chanc', 'machin', 'lay', 'impress', 'farm', 'stress', 'rel', 'hall', 'growth', 'date', 'ye', 'protect', 'attitud', 'apart', 'written', 'size', 'save', 'initi', 'charact', 'suddenli', 'signific', 'reflect', 'march', 'independ', 'hit', 'congress', 'concept', 'vote', 'secur', 'maintain', 'listen', 'drink', 'command', 'bad', 'summer', 'ship', 'pick', 'enjoy', 'combin', 'spring', 'sat', 'lower', 'gain', 'earth', 'civil', 'attend', 'artist', 'agre', 'theori', 'teacher', 'store', 'languag', 'announc', 'degre', 'procedur', 'knowledg', 'dog', 'current', 'armi', 'writer', 'particularli', 'paid', 'hotel', 'file', 'earlier', 'cell', 'boat', 'sent', 'prove', 'lie', 'husband', 'hospit', 'advanc', 'thousand', 'surpris', 'pain', 'mention', 'besid', 'arrang', 'manner', 'dollar', 'certainli', 'bed', 'shot', 'opinion', 'fail', 'electr', 'due', 'throughout', 'strength', 'soviet', 'shape', 'plane', 'neither', 'nearli', 'expens', 'electron', 'directli', 'check', 'western', 'kennedi', 'corpor', 'anyon', 'length', 'french', 'truth', 'treatment', 'season', 'role', 'join', 'finish', 'communist', 'wrong', 'religion', 'liber', 'heat', 'green', 'travel', 'notic', 'fit', 'estim', 'dress', 'distribut', 'anim', 'scene', 'doctor', 'danger', 'corner', 'ran', 'promis', 'met', 'literatur', 'cultur', 'conduct', 'arriv', 'suffer', 'mayb', 'item', 'bar', 'loss', 'led', 'film', 'constitut', 'applic', 'technic', 'poet', 'patient', 'investig', 'grant', 'georg', 'freedom', 'former', 'faith', 'draw', 'domin', 'divis', 'de', 'connect', 'confer', 'burn', 'audienc', 'song', 'seri', 'publish', 'poem', 'mari', 'hot', 'essenti', 'declar', 'vari', 'radio', 'pool', 'marri', 'main', 'featur', 'cool', 'ball', 'model', 'honor', 'glass', 'extend', 'clearli', 'somewhat', 'recommend', 'precis', 'opposit', 'murder', 'leg', 'judg', 'intens', 'edg', 'distanc', 'characterist', 'wave', 'treat', 'suit', 'relationship', 'inch', 'handl', 'frequent', 'extrem', 'dri', 'bank', 'address', 'teach', 'staff', 'manufactur', 'key', 'choic', 'chief', 'break', 'skill', 'german', 'frame', 'easi', 'dream', 'director', 'bridg', 'statu', 'seek', 'larger', 'discov', 'cross', 'clean', 'blood', 'atom', 'style', 'protest', 'profession', 'oh', 'mass', 'marriag', 'hill', 'difficulti', 'daili', 'happi', 'examin', 'c', 'born', 'agreement', 'robert', 'fiscal', 'distinct', 'wash', 'rock', 'middl', 'forward', 'emerg', 'british', 'afternoon', 'affair', 'adjust', 'post', 'memori', 'europ', 'detect', 'block', 'aj', 'agenc', 'affect', 'mouth', 'mechan', 'justic', 'encourag', 'cathol', 'balanc', 'worker', 'shoulder', 'seriou', 'popular', 'interpret', 'commiss', 'citizen', 'awar', 'worri', 'sun', 'slowli', 'sampl', 'pleas', 'obvious', 'nuclear', 'legisl', 'incom', 'enemi', 'complex', 'attract', 'trip', 'thick', 'straight', 'latter', 'brother', 'bear', 'assur', 'seven', 'rhode', 'radiat', 'poor', 'oil', 'instanc', 'insist', 'conclus', 'concentr', 'bit', 'whatev', 'send', 'senat', 'roll', 'heavi', 'fix', 'facil', 'camp', 'russian', 'laugh', 'histor', 'finger', 'energi', 'corp', 'buy', 'aspect', 'sunday', 'repli', 'replac', 'push', 'extent', 'deni', 'deep', 'strike', 'spread', 'round', 'particip', 'illustr', 'destroy', 'demonstr', 'council', 'capit', 'campaign', 'appeal', 'ahead', 'team', 'sight', 'pretti', 'parent', 'none', 'ladi', 'health', 'analysi', 'weight', 'spot', 'shop', 'refus', 'motor', 'easili', 'definit', 'contract', 'column', 'coat', 'approv', 'annual', 'advantag', 'wage', 'titl', 'suffici', 'substanti', 'session', 'princip', 'junior', 'hardli', 'engag', 'convers', 'comfort', 'youth', 'tend', 'sleep', 'settl', 'sea', 'master', 'exercis', 'cooper', 'bright', 'b', 'teeth', 'spent', 'speed', 'secret', 'ride', 'purchas', 'execut', 'eight', 'despit', 'weapon', 'sharp', 'newspap', 'match', 'exactli', 'consequ', 'circl', 'capabl', 'built', 'appropri', 'spend', 'search', 'payment', 'news', 'mine', 'crowd', 'unless', 'telephon', 'stare', 'score', 'reveal', 'lose', 'jame', 'guest', 'garden', 'clay', 'behavior', 'thoma', 'signal', 'meant', 'kid', 'goal', 'ga', 'dinner', 'cri', 'cook', 'contrast', 'confus', 'comment', 'assembl', 'yard', 'shelter', 'repeat', 'june', 'jazz', 'henri', 'custom', 'circumst', 'benefit', 'avoid', 'articl', 'tone', 'seat', 'promot', 'primari', 'page', 'hole', 'formula', 'extens', 'devot', 'chicago', 'caught', 'add', 'win', 'sir', 'lord', 'integr', 'ident', 'eat', 'duti', 'correspond', 'christ', 'cattl', 'battl', 'approxim', 'wine', 'thin', 'surviv', 'soldier', 'prefer', 'phase', 'ideal', 'hell', 'flow', 'financi', 'fell', 'competit', 'charl', 'bottom', 'bond', 'wind', 'strang', 'sex', 'proper', 'kitchen', 'king', 'instrument', 'fashion', 'editor', 'convict', 'compos', 'bottl', 'worth', 'someon', 'solid', 'realiti', 'mission', 'highli', 'everyon', 'contact', 'wit', 'varieti', 'struggl', 'sensit', 'rose', 'older', 'load', 'failur', 'excel', 'effici', 'convent', 'breath', 'belong', 'atmospher', 'switch', 'sing', 'review', 'preserv', 'obviou', 'lock', 'leadership', 'jack', 'escap', 'devic', 'count', 'angel', 'adam', 'regular', 'mount', 'mike', 'governor', 'excit', 'admit', 'twenti', 'thank', 'scientif', 'resist', 'reserv', 'london', 'librari', 'instruct', 'employe', 'content', 'chair', 'wheel', 'warn', 'task', 'spoke', 'quickli', 'potenti', 'possess', 'poetri', 'goe', 'flower', 'famou', 'fair', 'display', 'confid', 'chapter', 'accomplish', 'winter', 'wear', 'vehicl', 'solut', 'shift', 'rifl', 'philosophi', 'moreov', 'minor', 'intellig', 'greatest', 'gather', 'forest', 'fli', 'capac', 'bird', 'warm', 'slow', 'resourc', 'republican', 'rain', 'provis', 'panel', 'narrow', 'lip', 'invit', 'financ', 'credit', 'belief', 'beat', 'abil', 'villag', 'tire', 'stretch', 'sell', 'schedul', 'pure', 'previou', 'otherwis', 'judgment', 'intent', 'index', 'imposs', 'identifi', 'fresh', 'familiar', 'economi', 'daughter', 'compet', 'captain', 'box', 'wood', 'will', 'shout', 'occasion', 'occas', 'nice', 'intellectu', 'ignor', 'gray', 'exchang', 'weak', 'vital', 'typic', 'tast', 'request', 'recal', 'neck', 'mountain', 'instal', 'indian', 'decad', 'commerci', 'broad', 'appoint', 'yesterday', 'uniform', 'transfer', 'slightli', 'seed', 'insur', 'divid', 'award', 'agent', 'ultim', 'truck', 'speech', 'sin', 'rare', 'quiet', 'print', 'pound', 'novel', 'loan', 'guess', 'exhibit', 'dramat', 'defin', 'crisi', 'congreg', 'career', 'aim', 'adopt', 'adequ', 'vocat', 'tension', 'stain', 'richard', 'rich', 'retir', 'nine', 'maximum', 'mail', 'lao', 'guard', 'germani', 'franc', 'fellow', 'evil', 'defend', 'site', 'reader', 'player', 'missil', 'messag', 'matur', 'legal', 'jew', 'fulli', 'frank', 'fifti', 'error', 'doubl', 'constant', 'compon', 'commit', 'classic', 'tool', 'sam', 'resid', 'perfect', 'mold', 'hate', 'flat', 'fat', 'faculti', 'delight', 'bomb', 'argument', 'valley', 'smaller', 'presenc', 'neighbor', 'minist', 'literari', 'leagu', 'iron', 'interior', 'graduat', 'glanc', 'fast', 'excess', 'empti', 'dust', 'coffe', 'brush', 'brief', 'argu', 'appreci', 'anod', 'util', 'tie', 'sheet', 'revolut', 'platform', 'metal', 'laid', 'elimin', 'urg', 'soil', 'shoot', 'resolut', 'railroad', 'p', 'motion', 'lift', 'knife', 'juli', 'jewish', 'introduc', 'formal', 'distinguish', 'candid', 'beach', 'automat', 'altern', 'virginia', 'trust', 'talent', 'sport', 'personnel', 'neighborhood', 'membership', 'guid', 'gross', 'curv', 'berlin', 'unusu', 'twice', 'transport', 'sweet', 'spiritu', 'slave', 'restrict', 'novemb', 'nobodi', 'mysteri', 'muscl', 'motiv', 'liquid', 'lean', 'interview', 'inevit', 'fourth', 'foot', 'foam', 'entertain', 'background', 'babi', 'automobil', 'attorney', 'advertis', 'accompani', 'uniqu', 'snake', 'releas', 'professor']

def valid_keys():
    keys = APIkey.objects.all()
    api_keys = []
    for k in keys:
        api_keys.append(k.key)
    return api_keys

def sentiment_analyser(text):
    dictionary = {"Review":[text]}
    datas = pd.DataFrame.from_dict(dictionary)
    SIA = SentimentIntensityAnalyzer()
    datas['polarity_score']=datas.Review.apply(lambda x:SIA.polarity_scores(x)
    ['compound'])
    print(datas['polarity_score'][0])
    if datas['polarity_score'][0]<0:
        datas['sentiment'] = "Negative"
    elif datas['polarity_score'][0]==0:
        datas['sentiment'] = "Neutral"
    else:
        datas['sentiment'] = "Positive"

    return datas['sentiment'][0]


def preprocessing(list1):
    ps_new = PorterStemmer()
    all_words = []
    tri = list()
    for w in list1:
        all_words.append(w.lower())

    for w in all_words:
        if(w not in stopwords and w.isalpha()):
            tri.append(ps_new.stem(w))

    X_test = np.zeros((1,1500))
    f = nltk.FreqDist(tri)
    document_freq = []
    for x in word_features:
        document_freq.append(f[x])
    X_test[0] = document_freq
    return X_test

def textclassifier(text):
    pickle_in = open("model.pickle","rb")
    model_pickle = pickle.load(pickle_in)
    X_test = preprocessing(text.split(" "))
    y_pred_pickle=model_pickle.predict(X_test)
    return y_pred_pickle[0]

def generatekey(stringLength=32):
    """Generate a random string of fixed length """
    letters = string.ascii_lowercase + string.digits
    return ''.join(random.choice(letters) for i in range(stringLength))
